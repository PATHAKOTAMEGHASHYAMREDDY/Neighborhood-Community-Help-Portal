<div class="dashboard-container">
  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="isSidebarCollapsed">
    <div class="sidebar-header">
      <h2>Community Help</h2>
      <button class="toggle-btn" (click)="toggleSidebar()" type="button">â˜°</button>
    </div>

    <nav class="sidebar-nav">
      <a routerLink="/helper/requests" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ“Š</span>
        <span class="nav-text">Dashboard</span>
      </a>
      <a routerLink="/helper/requests" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ“‹</span>
        <span class="nav-text">Available Requests</span>
      </a>
      <a routerLink="/helper/tasks" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-item">
        <span class="nav-icon">âœ…</span>
        <span class="nav-text">My Tasks</span>
      </a>
      <a routerLink="/profile" routerLinkActive="active" class="nav-item">
        <span class="nav-icon">ğŸ‘¤</span>
        <span class="nav-text">Profile</span>
      </a>
      <a (click)="logout()" class="nav-item logout">
        <span class="nav-icon">ğŸšª</span>
        <span class="nav-text">Logout</span>
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-content">
        <div>
          <h1>My Tasks</h1>
          <p>Manage your accepted help requests</p>
        </div>
      </div>
    </header>

    <!-- Loading State -->
    <div class="loading" *ngIf="isLoading">
      <p>Loading your tasks...</p>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <!-- Success Message -->
    <div class="success-message" *ngIf="successMessage">
      {{ successMessage }}
    </div>

    <!-- No Tasks -->
    <div class="no-tasks" *ngIf="!isLoading && myTasks.length === 0">
      <div class="empty-state">
        <div class="empty-icon">ğŸ“‹</div>
        <h3>No Tasks Yet</h3>
        <p>You haven't accepted any help requests yet.</p>
        <a routerLink="/helper/requests" class="browse-btn">Browse Available Requests</a>
      </div>
    </div>

    <!-- Tasks List -->
    <section class="tasks-section" *ngIf="!isLoading && myTasks.length > 0">
      <div class="tasks-grid">
        <div class="task-card" *ngFor="let task of myTasks">
          <div class="task-header">
            <h3>{{ task.title }}</h3>
            <span class="status-badge" [ngClass]="getStatusClass(task.status)">
              {{ task.status }}
            </span>
          </div>

          <div class="task-body">
            <p class="task-description">{{ task.description }}</p>

            <div class="task-meta">
              <div class="meta-item">
                <span class="meta-icon">ğŸ“</span>
                <span class="meta-text">{{ task.category }}</span>
              </div>
              <div class="meta-item">
                <span class="meta-icon">ğŸ‘¤</span>
                <span class="meta-text">{{ task.resident_name }}</span>
              </div>
              <div class="meta-item">
                <span class="meta-icon">ğŸ“</span>
                <span class="meta-text">{{ task.resident_location || 'Location not specified' }}</span>
              </div>
              <div class="meta-item">
                <span class="meta-icon">ğŸ“…</span>
                <span class="meta-text">{{ task.created_at | date:'short' }}</span>
              </div>
            </div>

            <!-- Status Progress -->
            <div class="status-timeline">
              <div class="timeline-item" [class.completed]="task.status === 'Accepted' || task.status === 'In-progress' || task.status === 'Completed'">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                  <h4>Accepted</h4>
                  <p>Task accepted by you</p>
                </div>
              </div>
              <div class="timeline-item" [class.completed]="task.status === 'In-progress' || task.status === 'Completed'">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                  <h4>In Progress</h4>
                  <p>Working on the task</p>
                </div>
              </div>
              <div class="timeline-item" [class.completed]="task.status === 'Completed'">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                  <h4>Completed</h4>
                  <p>Task finished</p>
                </div>
              </div>
            </div>
          </div>

          <div class="task-footer">
            <button
              *ngIf="task.status !== 'Pending'"
              class="action-btn chat-btn"
              (click)="openChat(task.id)"
              type="button">
              ğŸ’¬ Chat
            </button>
            <button
              *ngIf="canStartProgress(task.status)"
              class="action-btn start-btn"
              (click)="updateStatus(task.id, 'In-progress')"
              [disabled]="updatingId === task.id"
              type="button">
              {{ updatingId === task.id ? 'Updating...' : 'Start Progress' }}
            </button>
            <button
              *ngIf="canComplete(task.status)"
              class="action-btn complete-btn"
              (click)="updateStatus(task.id, 'Completed')"
              [disabled]="updatingId === task.id"
              type="button">
              {{ updatingId === task.id ? 'Updating...' : 'Mark as Completed' }}
            </button>
            <span *ngIf="task.status === 'Completed'" class="completed-badge">
              âœ… Task Completed
            </span>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>
