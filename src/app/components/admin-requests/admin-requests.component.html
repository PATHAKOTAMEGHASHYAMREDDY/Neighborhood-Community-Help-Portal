<div class="admin-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h2>Admin Panel</h2>
    </div>

    <nav class="sidebar-nav">
      <a routerLink="/admin" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" class="nav-item">
        <span class="nav-icon"><mat-icon>dashboard</mat-icon></span>
        <span class="nav-text">Dashboard</span>
      </a>
      <a routerLink="/admin/users" routerLinkActive="active" class="nav-item">
        <span class="nav-icon"><mat-icon>group</mat-icon></span>
        <span class="nav-text">Users</span>
      </a>
      <a routerLink="/admin/requests" routerLinkActive="active" class="nav-item">
        <span class="nav-icon"><mat-icon>assignment</mat-icon></span>
        <span class="nav-text">Requests</span>
      </a>
      <a routerLink="/admin/reports" routerLinkActive="active" class="nav-item">
        <span class="nav-icon"><mat-icon>report_problem</mat-icon></span>
        <span class="nav-text">Reports</span>
      </a>
      <a routerLink="/admin/analytics" routerLinkActive="active" class="nav-item">
        <span class="nav-icon"><mat-icon>analytics</mat-icon></span>
        <span class="nav-text">Analytics</span>
      </a>
      <a (click)="logout()" class="nav-item logout">
        <span class="nav-icon"><mat-icon>logout</mat-icon></span>
        <span class="nav-text">Logout</span>
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header class="dashboard-header">
      <div class="header-content">
        <div>
          <h1>Request Management</h1>
          <p>Monitor and manage all help requests</p>
        </div>
      </div>
    </header>

    <div class="dashboard-content">
      <!-- Loading State -->
      <div class="loading-container" *ngIf="isLoading">
        <div class="loading-spinner"></div>
        <p>Loading requests...</p>
      </div>

      <!-- Content -->
      <div *ngIf="!isLoading">
        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card total">
            <div class="stat-icon"><mat-icon>assignment</mat-icon></div>
            <div class="stat-info">
              <h3>Total Requests</h3>
              <p class="stat-number">{{ totalRequests }}</p>
            </div>
          </div>
          <div class="stat-card pending">
            <div class="stat-icon"><mat-icon>hourglass_empty</mat-icon></div>
            <div class="stat-info">
              <h3>Pending</h3>
              <p class="stat-number">{{ pendingRequests }}</p>
            </div>
          </div>
          <div class="stat-card accepted">
            <div class="stat-icon"><mat-icon>pan_tool</mat-icon></div>
            <div class="stat-info">
              <h3>Accepted</h3>
              <p class="stat-number">{{ acceptedRequests }}</p>
            </div>
          </div>
          <div class="stat-card in-progress">
            <div class="stat-icon"><mat-icon>sync</mat-icon></div>
            <div class="stat-info">
              <h3>In-Progress</h3>
              <p class="stat-number">{{ inProgressRequests }}</p>
            </div>
          </div>
          <div class="stat-card completed">
            <div class="stat-icon"><mat-icon>check_circle</mat-icon></div>
            <div class="stat-info">
              <h3>Completed</h3>
              <p class="stat-number">{{ completedRequests }}</p>
            </div>
          </div>
        </div>

        <!-- Filters -->
        <div class="filters-section">
          <div class="search-box">
            <input
              type="text"
              placeholder="Search by title, category, or resident..."
              (input)="onSearchChange($event)"
              class="search-input">
          </div>
          <div class="status-filters">
            <button [class.active]="filterStatus === 'All'" (click)="onStatusFilterChange('All')" class="filter-btn" type="button">All</button>
            <button [class.active]="filterStatus === 'Pending'" (click)="onStatusFilterChange('Pending')" class="filter-btn" type="button">Pending</button>
            <button [class.active]="filterStatus === 'Accepted'" (click)="onStatusFilterChange('Accepted')" class="filter-btn" type="button">Accepted</button>
            <button [class.active]="filterStatus === 'In-progress'" (click)="onStatusFilterChange('In-progress')" class="filter-btn" type="button">In-Progress</button>
            <button [class.active]="filterStatus === 'Completed'" (click)="onStatusFilterChange('Completed')" class="filter-btn" type="button">Completed</button>
          </div>
          <div class="sort-filters">
            <label>Sort by Date:</label>
            <button [class.active]="sortOrder === 'desc'" (click)="onSortOrderChange('desc')" class="filter-btn" type="button">
              <mat-icon>arrow_downward</mat-icon> Newest First
            </button>
            <button [class.active]="sortOrder === 'asc'" (click)="onSortOrderChange('asc')" class="filter-btn" type="button">
              <mat-icon>arrow_upward</mat-icon> Oldest First
            </button>
          </div>
        </div>

        <!-- Requests Table -->
        <div class="requests-table-container">
          <div class="no-data" *ngIf="filteredRequests.length === 0">
            <p>No requests found</p>
          </div>

          <table class="requests-table" *ngIf="filteredRequests.length > 0">
            <thead>
              <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Category</th>
                <th>Resident</th>
                <th>Helper</th>
                <th>Status</th>
                <th>Created</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let request of paginatedRequests">
                <td>#{{ request.id }}</td>
                <td class="title-cell">{{ request.title }}</td>
                <td><span class="category-badge">{{ request.category }}</span></td>
                <td>{{ request.resident_name || 'N/A' }}</td>
                <td>{{ request.helper_name || 'Unassigned' }}</td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusClass(request.status)">
                    {{ request.status }}
                  </span>
                </td>
                <td>{{ request.created_at | date:'short' }}</td>
              </tr>
            </tbody>
          </table>

          <!-- Pagination -->
          <div class="pagination" *ngIf="filteredRequests.length > 0">
            <button class="pagination-btn" (click)="previousPage()" [disabled]="currentPage === 1" type="button">
              <mat-icon>chevron_left</mat-icon>
            </button>

            <button *ngFor="let page of getPageNumbers()" 
                    class="pagination-btn page-number" 
                    [class.active]="page === currentPage"
                    (click)="goToPage(page)" 
                    type="button">
              {{ page }}
            </button>

            <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage === totalPages" type="button">
              <mat-icon>chevron_right</mat-icon>
            </button>

            <span class="pagination-info">
              Page {{ currentPage }} of {{ totalPages }} ({{ filteredRequests.length }} total)
            </span>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
